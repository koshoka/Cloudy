# Cloudy 要件定義書（ユーザーフィードバック反映版）

## 1. プロジェクト概要

### 1.1 プロジェクト名
**Cloudy** - CLIの機能性にGUIの親しみやすさを統合したClaude Code GUI

### 1.2 プロジェクトの目的
「6畳の質素な空間に観葉植物を置く」コンセプトの下、Claude Code CLIの全機能を保持しながら、Claudiaスタイルの視覚的な優しさを統合したGUIアプリケーションを開発する。ローカル環境のカスタマイズ（`ccode`エイリアス等）を尊重し、日常使いに最適化された統一UXを提供する。

### 1.3 参考実装アプローチ
- **Claudia参考実装要素**: プロジェクト選択UI、セッション管理、カード型メッセージUI、デザインシステム
- **新規開発要素**: ターミナル統合、権限設定チェックボックス、朝・夕テーマシステム、ローカル設定カスタマイズ

## 2. ユーザーストーリー

### 2.1 メインユーザー
- **最優先**: Claude Code CLIユーザー - ターミナル操作に慣れ親しんだ開発者（日常使いツールとしての利用）
- **対象**: 中間層 - 初心者向けの親しみやすさと既存CLI設定の継承を求める開発者

### 2.2 核心ユーザーストーリー

#### 起動・プロジェクト選択フロー
- **US-001**: 開発者として、Cloudyアプリ起動時にClaudiaスタイルのプロジェクト選択画面を見たい
- **US-002**: 開発者として、プロジェクト選択後に過去セッション一覧から作業を継続したい
- **US-003**: 開発者として、新規セッション開始時に権限設定（`--dangerously-skip-permissions`）をチェックボックスで選択したい
- **US-004**: 開発者として、権限設定の状態を保持して次回起動時にも反映されてほしい

->権限設定（`--dangerously-skip-permissions`）のチェックは、`--dangerously-skip-permissions`というコマンド名を表示してもユーザーからしたら分かりにくい。なので、「skip mode」みたいに表示しておいて、実際には「`--dangerously-skip-permissions`」のコマンドが付け加えられて実行される仕組みにしてほしい。

#### ターミナル統合・CLI機能維持
- **US-005**: 開発者として、`ccode`等のローカルエイリアスをそのまま使用したい
- **US-006**: 開発者として、`shift+tab`でのモード切り替え（accept edits on/off、plan mode on/off等）を使用したい
- **US-007**: 開発者として、`/model`、`/permissions`、`/status`等の全ビルトインコマンドをGUI内で実行したい
- **US-008**: 開発者として、`ccode -r`相当のセッション復元機能を使用したい

#### 視覚的なGUI体験
- **US-009**: ユーザーとして、Claudeからの返答をロボットアイコン付きのカード型UIで表示してほしい
- **US-010**: ユーザーとして、「朝」「夕」テーマを選択して目に優しい色使いで作業したい
- **US-011**: ユーザーとして、対話感のあるチャット風UIでClaude Codeと会話したい

#### シンプルな操作
- **US-012**: ユーザーとして、複雑な機能は避けて1セッションずつシンプルに作業したい
- **US-013**: ユーザーとして、不要な分析機能やサイドバーなしのクリーンなUIで集中したい

## 3. 機能要件

### 3.1 プロジェクト選択・起動フロー

#### 3.1.1 プロジェクト選択画面（Claudia参考実装）
- **REQ-001**: Claudiaスタイルのプロジェクト選択画面実装
- **REQ-002**: Recent Projectsリスト表示
- **REQ-003**: 「Open Project」ボタンでディレクトリ選択
- **REQ-004**: プロジェクトパス表示

#### 3.1.2 セッション選択・権限設定
- **REQ-005**: 選択プロジェクトの過去セッション一覧表示
- **REQ-006**: 新規セッション作成ボタン
- **REQ-007**: 権限設定チェックボックス（`--dangerously-skip-permissions`）
    -> 実際には`--dangerously-skip-permissions`が実行されるも、フロントエンドで表示される名称としては「skip mode」にする。じゃないと分かりにくい。
- **REQ-008**: 権限設定状態の永続化・次回起動時自動復元
- **REQ-009**: セッション復元機能（`ccode -r`相当）

### 3.2 ターミナル統合機能

#### 3.2.1 基本ターミナル機能
- **REQ-010**: xterm.js + node-ptyによるターミナルエミュレーション
- **REQ-011**: Claude Code CLIとのリアルタイム双方向通信
- **REQ-012**: ローカルエイリアス（`ccode`）対応
- **REQ-013**: コピー＆ペースト・選択範囲対応

#### 3.2.2 Claude Code CLI完全対応
- **REQ-014**: 全ビルトインコマンド対応（`/model`、`/permissions`、`/status`等）
- **REQ-015**: `shift+tab`によるモード切り替え対応
- **REQ-016**: accept edits on/off、plan mode on/off、bypass permissions on/off
- **REQ-017**: 既存CLI設定・MCP設定の自動継承

### 3.3 視覚的GUI機能

#### 3.3.1 カード型メッセージUI（Claudia参考実装）
- **REQ-018**: Claudeからの返答をカード型で表示
- **REQ-019**: ロボットアイコン付きメッセージ表示
- **REQ-020**: チャット風対話インターフェース
- **REQ-021**: 入力欄を画面下部に配置

#### 3.3.2 テーマシステム
- **REQ-022**: 朝テーマ（ライト/ダーク）: 水色〜ピンクグラデーション
- **REQ-023**: 夕テーマ（ライト/ダーク）: 紫〜ピンクグラデーション  
- **REQ-024**: テーマ選択機能・設定保存
- **REQ-025**: 和紙のような優しい背景色（真っ黒避ける）

### 3.4 シンプル設計機能

#### 3.4.1 基本レイアウト
- **REQ-026**: 1セッションずつのシンプル処理
- **REQ-027**: サイドバーなしのクリーンなUI
- **REQ-028**: ドラッグ＆ドロップ等の複雑操作は除外
- **REQ-029**: Tailwind CSS + Radix UIベースのコンポーネント

#### 3.4.2 省略機能
- **REQ-030**: 使用状況分析・グラフ表示は実装しない
- **REQ-031**: 複数セッション並行実行は実装しない  
- **REQ-032**: MCP管理画面は実装しない（既存設定自動継承のみ）
- **REQ-033**: セッション統計・エクスポート機能は実装しない

## 4. 非機能要件

### 4.1 パフォーマンス要件

#### 4.1.1 レスポンス性能（個人利用最適化）
- **NFR-001**: ターミナルコマンド実行レスポンス: 50ms以下
- **NFR-002**: プロジェクト選択画面の表示: 500ms以下  
- **NFR-003**: セッション起動時間: 3秒以下
- **NFR-004**: アプリケーション起動時間: 3秒以下

#### 4.1.2 リソース使用量（軽量設計）
- **NFR-005**: メモリ使用量: 300MB以下（アイドル状態）
- **NFR-006**: CPU使用量: 5%以下（アイドル状態）
- **NFR-007**: ディスク使用量: 500MB以下（インストール後）

#### 4.1.3 安定性（単一セッション）
- **NFR-008**: 単一セッションで安定動作（24時間以上）
- **NFR-009**: クラッシュ時の自動セッション復旧

### 4.2 ユーザビリティ要件

#### 4.2.1 学習容易性
- **NFR-010**: Claude Code CLIユーザーが5分以内で基本操作習得可能
- **NFR-011**: 初回起動時に直感的に操作方法を理解可能

#### 4.2.2 操作性（日常使い最適化）
- **NFR-012**: 主要機能へのキーボードショートカットアクセス
- **NFR-013**: マウスクリック最小限での操作完了
- **NFR-014**: 設定値の自動保持・復元

### 4.3 互換性要件

#### 4.3.1 プラットフォーム対応
- **NFR-015**: macOS 11.0以降対応（優先）
- **NFR-016**: Windows 10以降対応
- **NFR-017**: Ubuntu 20.04以降対応

#### 4.3.2 Claude Code CLI対応
- **NFR-018**: Claude Code CLI最新版との完全互換性
- **NFR-019**: ローカルCLI設定（エイリアス、MCP等）の自動継承

### 4.4 可用性要件

#### 4.4.1 安定性
- **NFR-020**: 連続動作: 99.9%以上のアップタイム
- **NFR-021**: クラッシュ復旧: 自動復旧・セッション保持機能

#### 4.4.2 データ保護
- **NFR-022**: セッションデータの自動バックアップ
- **NFR-023**: 設定データの冗長保存

### 4.5 セキュリティ要件

#### 4.5.1 データ保護
- **NFR-024**: API キー・トークンの暗号化保存
- **NFR-025**: ローカルデータベースの暗号化
- **NFR-026**: セッションデータの暗号化通信

#### 4.5.2 アクセス制御
- **NFR-027**: ファイルシステムアクセスのサンドボックス化
- **NFR-028**: ネットワークアクセスの制限・監視

### 4.6 保守性要件

#### 4.6.1 更新対応
- **NFR-029**: 自動アップデート機能
- **NFR-030**: 段階的ロールアウト対応
- **NFR-031**: 設定・データの下位互換性保持

#### 4.6.2 診断・ログ
- **NFR-032**: 詳細なエラーログ・診断情報出力
- **NFR-033**: リモート診断・サポート機能

## 5. 技術要件

### 5.1 技術スタック（シンプル構成）
- **フロントエンド**: React 18 + TypeScript + Vite
- **デスクトップ**: Electron（ターミナル統合のためNode.js必須）
- **UI Framework**: Tailwind CSS + Radix UI（Claudia参考）
- **状態管理**: Zustand（軽量）
- **データ永続化**: localStorage（設定保存用）
- **ターミナル**: xterm.js + node-pty

### 5.2 アーキテクチャ（Electron中心）
- Electron単一構成（複雑なハイブリッドアーキテクチャ避ける）
- メインプロセス：Claude Code CLI制御・セッション管理
- レンダラープロセス：React UI・ターミナル表示
- IPC通信：プロセス間データ交換

### 5.3 品質保証（最小限）
- TypeScript厳密型チェック
- ESLint + Prettier
- 基本的な手動テスト

## 6. 制約事項

### 6.1 技術的制約
- Claude Code CLI APIに依存（APIの変更に影響される）
- xterm.js + node-ptyのターミナルエミュレーション制限
- Electronアプリのパッケージサイズ

### 6.2 開発制約
- **開発目標**: 個人の日常使いツール（商用目的なし）
- **開発期間**: 制限なし（品質優先）
- **開発者**: 個人開発（1名）

### 6.3 外部依存
- Claude Code CLI の安定性・互換性
- xterm.js・node-ptyライブラリの継続メンテナンス
- Electronフレームワークのセキュリティアップデート

## 7. 成功基準（個人使用重視）

### 7.1 機能的成功基準
- [ ] 全Claude Code CLIコマンドがGUI内で実行可能
- [ ] `ccode`エイリアス等のローカル設定が正常動作
- [ ] セッション復元（`-r`相当）機能が動作

### 7.2 品質的成功基準（日常使い）
- [ ] 開発者本人が快適に日常使用できる
- [ ] 起動から作業開始まで10秒以内
- [ ] 24時間安定動作（クラッシュなし）

### 7.3 将来的目標
- [ ] オープンソース公開
- [ ] コミュニティフィードバック収集
- [ ] 他ユーザーの利用・貢献促進

---

**作成日**: 2025年08月21日  
**更新日**: 2025年08月21日（ユーザーフィードバック反映）  
**作成者**: Claude Code Spec-Driven Development  
**バージョン**: v2.0  
**レビューステータス**: ユーザーフィードバック反映完了・実装準備完了